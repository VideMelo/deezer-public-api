{"version":3,"file":"deezer-public-api.module.js","sources":["../src/domains/search.ts","../src/domains/track.ts","../src/domains/album.ts","../src/domains/artist.ts","../src/domains/auth.ts","../src/deezer-public-api.ts"],"sourcesContent":["import DeezerPublicApi, { GlobalParameters } from '../deezer-public-api.js';\nimport { DeezerSearch } from '../types.js';\n\nexport type AdvancedSearchOperator = 'artist' | 'album' | 'track' | 'label' | 'dur_min' | 'dur_max' | 'bpm_min' | 'bpm_max';\n\nexport default class Search {\n  private api;\n\n  constructor(api: DeezerPublicApi) {\n    this.api = api;\n  }\n\n  all({\n    query, order, limit, index, strict,\n  }: {\n    query: string | Record<AdvancedSearchOperator & 'term', string>\n    strict?: boolean\n  } & GlobalParameters) {\n    let stringifiedQuery: string;\n    if (typeof query === 'object') {\n      stringifiedQuery = Object.entries(query).map(([operator, value]) => `${operator}:\"${value}\"`).join('');\n    } else {\n      stringifiedQuery = query;\n    }\n\n    return this.api.request({\n      uri: 'search', query: stringifiedQuery, strict, order, index, limit,\n    });\n  }\n\n  album({\n    query, order, limit, index, strict,\n  }: {\n    query: string\n    strict?: boolean\n  } & GlobalParameters): Promise<DeezerSearch> {\n    return this.api.request({\n      uri: 'search/album', query, strict, order, index, limit,\n    });\n  }\n\n  artist({\n    query, order, limit, index, strict,\n  }: {\n    query: string\n    strict?: boolean\n  } & GlobalParameters): Promise<DeezerSearch> {\n    return this.api.request({\n      uri: 'search/artist', query, strict, order, index, limit,\n    });\n  }\n\n  playlist({\n    query, order, limit, index, strict,\n  }: {\n    query: string\n    strict?: boolean\n  } & GlobalParameters): Promise<DeezerSearch> {\n    return this.api.request({\n      uri: 'search/playlist', query, strict, order, index, limit,\n    });\n  }\n\n  podcast({\n    query, order, limit, index, strict,\n  }: {\n    query: string\n    strict?: boolean\n  } & GlobalParameters): Promise<DeezerSearch> {\n    return this.api.request({\n      uri: 'search/podcast', query, strict, order, index, limit,\n    });\n  }\n\n  radio({\n    query, order, limit, index, strict,\n  }: {\n    query: string\n    strict?: boolean\n  } & GlobalParameters): Promise<DeezerSearch> {\n    return this.api.request({\n      uri: 'search/radio', query, strict, order, index, limit,\n    });\n  }\n\n  track({\n    query, order, limit, index, strict,\n  }: {\n    query: string\n    strict?: boolean\n  } & GlobalParameters): Promise<DeezerSearch> {\n    return this.api.request({\n      uri: 'search/track', query, strict, order, index, limit,\n    });\n  }\n\n  user({\n    query, order, limit, index, strict,\n  }: {\n    query: string\n    strict?: boolean\n  } & GlobalParameters): Promise<DeezerSearch> {\n    return this.api.request({\n      uri: 'search/user', query, strict, order, index, limit,\n    });\n  }\n}\n","import DeezerPublicApi from '../deezer-public-api.js';\n\nexport default class Track {\n  private api;\n\n  constructor(api: DeezerPublicApi) {\n    this.api = api;\n  }\n\n  get({\n    id,\n  }: {\n    id: number\n  }): Promise<Track> {\n    return this.api.request({\n      uri: `track/${id}`,\n    });\n  }\n}\n","import DeezerPublicApi from '../deezer-public-api.js';\n\nexport default class Album {\n  private api;\n\n  constructor(api: DeezerPublicApi) {\n    this.api = api;\n  }\n\n  get({\n    id,\n  }: {\n    id: number\n  }): Promise<Album> {\n    return this.api.request({\n      uri: `album/${id}`,\n    });\n  }\n\n  fans({\n    id,\n  }: {\n    id: number\n  }) {\n    return this.api.request({\n      uri: `album/${id}/fans`,\n    });\n  }\n\n  tracks({\n    id,\n  }: {\n    id: number\n  }) {\n    return this.api.request({\n      uri: `album/${id}/fans`,\n    });\n  }\n}\n","import DeezerPublicApi from '../deezer-public-api.js';\n\nexport default class Artist {\n  private api;\n\n  constructor(api: DeezerPublicApi) {\n    this.api = api;\n  }\n\n  get({\n    id,\n  }: {\n    id: number\n  }): Promise<Artist> {\n    return this.api.request({\n      uri: `artist/${id}`,\n    });\n  }\n\n  top({\n    id,\n  }: {\n    id: number\n  }) {\n    return this.api.request({\n      uri: `artist/${id}/top`,\n    });\n  }\n\n  albums({\n    id,\n  }: {\n    id: number\n  }) {\n    return this.api.request({\n      uri: `albums/${id}/top`,\n    });\n  }\n\n  fans({\n    id,\n  }: {\n    id: number\n  }) {\n    return this.api.request({\n      uri: `artist/${id}/top`,\n    });\n  }\n\n  related({\n    id,\n  }: {\n    id: number\n  }) {\n    return this.api.request({\n      uri: `artist/${id}/top`,\n    });\n  }\n\n  radio({\n    id,\n  }: {\n    id: number\n  }) {\n    return this.api.request({\n      uri: `artist/${id}/top`,\n    });\n  }\n\n  playlist({\n    id,\n  }: {\n    id: number\n  }) {\n    return this.api.request({\n      uri: `artist/${id}/top`,\n    });\n  }\n}\n","import * as http from 'node:http';\nimport DeezerPublicApi from '../deezer-public-api.js';\n\nexport default class Auth {\n  private api;\n\n  constructor(api: DeezerPublicApi) {\n    this.api = api;\n  }\n\n  setup({\n    appId,\n    redirectUri,\n    perms,\n  }: { appId: string, redirectUri?: string, perms?: string | string[] }) {\n    this.api.config = {\n      ...this.api.config,\n      appId,\n      redirectUri,\n      perms: typeof perms === 'string' ? [perms] : perms,\n    };\n  }\n\n  getLoginUrl() {\n    if (!this.api.config.appId || !this.api.config.redirectUri) {\n      throw new Error('auth.setup(opts: { appId: string, redirectUri: string, perms?: string | string[] }) should be called before auth.getLoginUrl');\n    }\n\n    const url = new URL('https://connect.deezer.com/oauth/auth.php');\n    url.searchParams.set('app_id', this.api.config.appId);\n    url.searchParams.set('redirect_uri', this.api.config.redirectUri);\n    url.searchParams.set('perms', (this.api.config.perms ?? []).join(','));\n    return url.toString();\n  }\n\n  waitForLoginCallback() {\n    return new Promise((resolve) => {\n      if (!this.api.config.appId || !this.api.config.redirectUri) {\n        throw new Error('auth.setup(opts: { appId: string, redirectUri: string, perms?: string | string[] }) should be called before auth.getLoginUrl');\n      }\n\n      const redirectUri = new URL(this.api.config.redirectUri);\n\n      const server = http.createServer((req, res) => {\n        const requestUrl = new URL(req.url ?? '/', `http://${req.headers.host}`);\n\n        if (requestUrl.pathname === redirectUri.pathname && requestUrl.searchParams.has('code')) {\n          resolve({\n            code: requestUrl.searchParams.get('code'),\n          });\n\n          res.writeHead(200, { 'Content-Type': 'text/html' }).end('<html><body><div style=\"display: grid; place-content: center; font-family: sans-serif\"><h1>Auth code received</h1><p>You can close this window and get back to your terminal</p></div></body></html>');\n\n          server.close(() => {\n            console.log('closed');\n          });\n        }\n      });\n\n      server.listen(redirectUri.port);\n    });\n  }\n}\n","import { request } from 'undici';\nimport Search from './domains/search.js';\nimport Track from './domains/track.js';\nimport Album from './domains/album.js';\nimport Artist from './domains/artist.js';\nimport Auth from './domains/auth.js';\n\nexport interface GlobalParameters {\n  index?: number;\n  limit?: number;\n  order?: string;\n}\nexport default class DeezerPublicApi {\n  auth = new Auth(this);\n\n  search = new Search(this);\n\n  track = new Track(this);\n\n  album = new Album(this);\n\n  artist = new Artist(this);\n\n  deezerApiBaseUrl = 'https://api.deezer.com/';\n\n  config: Partial<{\n    appId: string, redirectUri: string, perms: string[]\n  }> = {};\n\n  async request({\n    uri, index, limit, order, strict, query,\n  }: {\n    uri: string;\n    query?: string;\n    strict?: boolean;\n  } & GlobalParameters) {\n    const url = new URL(uri, this.deezerApiBaseUrl);\n\n    const setParam = (key: string, value?: unknown) => (typeof value !== 'undefined' ? url.searchParams.set(key, String(value)) : undefined);\n\n    setParam('q', query);\n    setParam('index', index);\n    setParam('limit', limit);\n    setParam('order', order);\n    setParam('strict', strict ? 'on' : undefined);\n\n    console.log(url.toString(), {\n      uri, index, limit, order, strict, query,\n    });\n\n    const { body } = await request(url);\n\n    return body.json();\n  }\n}\n"],"names":["Search","api","this","_proto","prototype","all","_ref","stringifiedQuery","query","order","limit","index","strict","Object","entries","map","_ref2","value","join","request","uri","album","_ref3","artist","_ref4","playlist","_ref5","podcast","_ref6","radio","_ref7","track","_ref8","user","_ref9","Track","get","id","Album","fans","tracks","Artist","top","albums","related","Auth","setup","perms","config","_extends","appId","redirectUri","getLoginUrl","_this$api$config$perm","Error","url","URL","searchParams","set","toString","waitForLoginCallback","_this","Promise","resolve","server","http","createServer","req","res","_req$url","requestUrl","headers","host","pathname","has","code","writeHead","end","close","console","log","listen","port","DeezerPublicApi","auth","search","deezerApiBaseUrl","setParam","key","String","undefined","then","body","json","e","reject"],"mappings":"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"}