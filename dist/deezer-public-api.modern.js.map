{"version":3,"file":"deezer-public-api.modern.js","sources":["../src/domains/search.ts","../src/domains/track.ts","../src/domains/album.ts","../src/domains/artist.ts","../src/domains/auth.ts","../src/deezer-public-api.ts"],"sourcesContent":["import DeezerPublicApi, { GlobalParameters } from '../deezer-public-api.js';\nimport { DeezerSearch } from '../types.js';\n\nexport type AdvancedSearchOperator = 'artist' | 'album' | 'track' | 'label' | 'dur_min' | 'dur_max' | 'bpm_min' | 'bpm_max';\n\nexport default class Search {\n  private api;\n\n  constructor(api: DeezerPublicApi) {\n    this.api = api;\n  }\n\n  all({\n    query, order, limit, index, strict,\n  }: {\n    query: string | Record<AdvancedSearchOperator & 'term', string>\n    strict?: boolean\n  } & GlobalParameters) {\n    let stringifiedQuery: string;\n    if (typeof query === 'object') {\n      stringifiedQuery = Object.entries(query).map(([operator, value]) => `${operator}:\"${value}\"`).join('');\n    } else {\n      stringifiedQuery = query;\n    }\n\n    return this.api.request({\n      uri: 'search', query: stringifiedQuery, strict, order, index, limit,\n    });\n  }\n\n  album({\n    query, order, limit, index, strict,\n  }: {\n    query: string\n    strict?: boolean\n  } & GlobalParameters): Promise<DeezerSearch> {\n    return this.api.request({\n      uri: 'search/album', query, strict, order, index, limit,\n    });\n  }\n\n  artist({\n    query, order, limit, index, strict,\n  }: {\n    query: string\n    strict?: boolean\n  } & GlobalParameters): Promise<DeezerSearch> {\n    return this.api.request({\n      uri: 'search/artist', query, strict, order, index, limit,\n    });\n  }\n\n  playlist({\n    query, order, limit, index, strict,\n  }: {\n    query: string\n    strict?: boolean\n  } & GlobalParameters): Promise<DeezerSearch> {\n    return this.api.request({\n      uri: 'search/playlist', query, strict, order, index, limit,\n    });\n  }\n\n  podcast({\n    query, order, limit, index, strict,\n  }: {\n    query: string\n    strict?: boolean\n  } & GlobalParameters): Promise<DeezerSearch> {\n    return this.api.request({\n      uri: 'search/podcast', query, strict, order, index, limit,\n    });\n  }\n\n  radio({\n    query, order, limit, index, strict,\n  }: {\n    query: string\n    strict?: boolean\n  } & GlobalParameters): Promise<DeezerSearch> {\n    return this.api.request({\n      uri: 'search/radio', query, strict, order, index, limit,\n    });\n  }\n\n  track({\n    query, order, limit, index, strict,\n  }: {\n    query: string\n    strict?: boolean\n  } & GlobalParameters): Promise<DeezerSearch> {\n    return this.api.request({\n      uri: 'search/track', query, strict, order, index, limit,\n    });\n  }\n\n  user({\n    query, order, limit, index, strict,\n  }: {\n    query: string\n    strict?: boolean\n  } & GlobalParameters): Promise<DeezerSearch> {\n    return this.api.request({\n      uri: 'search/user', query, strict, order, index, limit,\n    });\n  }\n}\n","import DeezerPublicApi from '../deezer-public-api.js';\n\nexport default class Track {\n  private api;\n\n  constructor(api: DeezerPublicApi) {\n    this.api = api;\n  }\n\n  get({\n    id,\n  }: {\n    id: number\n  }): Promise<Track> {\n    return this.api.request({\n      uri: `track/${id}`,\n    });\n  }\n}\n","import DeezerPublicApi from '../deezer-public-api.js';\n\nexport default class Album {\n  private api;\n\n  constructor(api: DeezerPublicApi) {\n    this.api = api;\n  }\n\n  get({\n    id,\n  }: {\n    id: number\n  }): Promise<Album> {\n    return this.api.request({\n      uri: `album/${id}`,\n    });\n  }\n\n  fans({\n    id,\n  }: {\n    id: number\n  }) {\n    return this.api.request({\n      uri: `album/${id}/fans`,\n    });\n  }\n\n  tracks({\n    id,\n  }: {\n    id: number\n  }) {\n    return this.api.request({\n      uri: `album/${id}/fans`,\n    });\n  }\n}\n","import DeezerPublicApi from '../deezer-public-api.js';\n\nexport default class Artist {\n  private api;\n\n  constructor(api: DeezerPublicApi) {\n    this.api = api;\n  }\n\n  get({\n    id,\n  }: {\n    id: number\n  }): Promise<Artist> {\n    return this.api.request({\n      uri: `artist/${id}`,\n    });\n  }\n\n  top({\n    id,\n  }: {\n    id: number\n  }) {\n    return this.api.request({\n      uri: `artist/${id}/top`,\n    });\n  }\n\n  albums({\n    id,\n  }: {\n    id: number\n  }) {\n    return this.api.request({\n      uri: `albums/${id}/top`,\n    });\n  }\n\n  fans({\n    id,\n  }: {\n    id: number\n  }) {\n    return this.api.request({\n      uri: `artist/${id}/top`,\n    });\n  }\n\n  related({\n    id,\n  }: {\n    id: number\n  }) {\n    return this.api.request({\n      uri: `artist/${id}/top`,\n    });\n  }\n\n  radio({\n    id,\n  }: {\n    id: number\n  }) {\n    return this.api.request({\n      uri: `artist/${id}/top`,\n    });\n  }\n\n  playlist({\n    id,\n  }: {\n    id: number\n  }) {\n    return this.api.request({\n      uri: `artist/${id}/top`,\n    });\n  }\n}\n","import * as http from 'node:http';\nimport DeezerPublicApi from '../deezer-public-api.js';\n\nexport default class Auth {\n  private api;\n\n  constructor(api: DeezerPublicApi) {\n    this.api = api;\n  }\n\n  setup({\n    appId,\n    redirectUri,\n    perms,\n  }: { appId: string, redirectUri?: string, perms?: string | string[] }) {\n    this.api.config = {\n      ...this.api.config,\n      appId,\n      redirectUri,\n      perms: typeof perms === 'string' ? [perms] : perms,\n    };\n  }\n\n  getLoginUrl() {\n    if (!this.api.config.appId || !this.api.config.redirectUri) {\n      throw new Error('auth.setup(opts: { appId: string, redirectUri: string, perms?: string | string[] }) should be called before auth.getLoginUrl');\n    }\n\n    const url = new URL('https://connect.deezer.com/oauth/auth.php');\n    url.searchParams.set('app_id', this.api.config.appId);\n    url.searchParams.set('redirect_uri', this.api.config.redirectUri);\n    url.searchParams.set('perms', (this.api.config.perms ?? []).join(','));\n    return url.toString();\n  }\n\n  waitForLoginCallback() {\n    return new Promise((resolve) => {\n      if (!this.api.config.appId || !this.api.config.redirectUri) {\n        throw new Error('auth.setup(opts: { appId: string, redirectUri: string, perms?: string | string[] }) should be called before auth.getLoginUrl');\n      }\n\n      const redirectUri = new URL(this.api.config.redirectUri);\n\n      const server = http.createServer((req, res) => {\n        const requestUrl = new URL(req.url ?? '/', `http://${req.headers.host}`);\n\n        if (requestUrl.pathname === redirectUri.pathname && requestUrl.searchParams.has('code')) {\n          resolve({\n            code: requestUrl.searchParams.get('code'),\n          });\n\n          res.writeHead(200, { 'Content-Type': 'text/html' }).end('<html><body><div style=\"display: grid; place-content: center; font-family: sans-serif\"><h1>Auth code received</h1><p>You can close this window and get back to your terminal</p></div></body></html>');\n\n          server.close(() => {\n            console.log('closed');\n          });\n        }\n      });\n\n      server.listen(redirectUri.port);\n    });\n  }\n}\n","import { request } from 'undici';\nimport Search from './domains/search.js';\nimport Track from './domains/track.js';\nimport Album from './domains/album.js';\nimport Artist from './domains/artist.js';\nimport Auth from './domains/auth.js';\n\nexport interface GlobalParameters {\n  index?: number;\n  limit?: number;\n  order?: string;\n}\nexport default class DeezerPublicApi {\n  auth = new Auth(this);\n\n  search = new Search(this);\n\n  track = new Track(this);\n\n  album = new Album(this);\n\n  artist = new Artist(this);\n\n  deezerApiBaseUrl = 'https://api.deezer.com/';\n\n  config: Partial<{\n    appId: string, redirectUri: string, perms: string[]\n  }> = {};\n\n  async request({\n    uri, index, limit, order, strict, query,\n  }: {\n    uri: string;\n    query?: string;\n    strict?: boolean;\n  } & GlobalParameters) {\n    const url = new URL(uri, this.deezerApiBaseUrl);\n\n    const setParam = (key: string, value?: unknown) => (typeof value !== 'undefined' ? url.searchParams.set(key, String(value)) : undefined);\n\n    setParam('q', query);\n    setParam('index', index);\n    setParam('limit', limit);\n    setParam('order', order);\n    setParam('strict', strict ? 'on' : undefined);\n\n    console.log(url.toString(), {\n      uri, index, limit, order, strict, query,\n    });\n\n    const { body } = await request(url);\n\n    return body.json();\n  }\n}\n"],"names":["Search","constructor","api","this","all","query","order","limit","index","strict","stringifiedQuery","Object","entries","map","operator","value","join","request","uri","album","artist","playlist","podcast","radio","track","user","Track","get","id","Album","fans","tracks","Artist","top","albums","related","Auth","setup","appId","redirectUri","perms","config","_extends","getLoginUrl","_this$api$config$perm","Error","url","URL","searchParams","set","toString","waitForLoginCallback","Promise","resolve","server","http","createServer","req","res","_req$url","requestUrl","headers","host","pathname","has","code","writeHead","end","close","console","log","listen","port","DeezerPublicApi","auth","search","deezerApiBaseUrl","async","setParam","key","String","undefined","body","json"],"mappings":"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"}